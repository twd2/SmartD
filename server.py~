#!/usr/bin/env python3

import os.path
import tornado.ioloop
import tornado.web
from tornado import options

options.define('port', default=8888, help='HTTP server port.')
options.define('secret', default='9be11db93e203cea096e49d3ddc8db78', help='Cookie secret.')

Root = os.path.dirname(__file__)
Routes = []

def rel_path(p):
  return os.path.join(Root, p)

def route(r):
  def decorate(cls):
    Routes.append((r, cls))
    return cls

@route('/')
class MainHandler(tornado.web.RequestHandler):
  def get(self):
    self.write("Hello, world")

def make_app(routes):
  return tornado.web.Application(routes,
                                 cookie_secret=options.options.secret,
                                 template_path=rel_path('template'),
                                 static_path=rel_path('static'),
                                 xsrf_cookies=True,
                                 debug=True)

def main():
  from smartd.view import main
  app = make_app(Routes)
  app.listen(options.options.port)
  tornado.ioloop.IOLoop.current().start()

if __name__ == '__main__':
  main()
